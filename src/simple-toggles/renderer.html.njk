{% macro render_toggle(props) %}
  {{ _render_single_state_toggle({ "id": props.id, "state": props.state }) | trim }}

  {% for state in [true, false] %}
    <script id="{{ _make_script_id({ 'id': props.id, 'state': state }) }}" type="text/html">
      {{ _render_single_state_toggle({ "id": props.id, "state": state }) | trim }}
    </script>
  {% endfor %}
{% endmacro %}

{% macro _render_single_state_toggle(props) %}
  {% set size = 2 %}

  <div
    class="flex flex-row gap-2 p-2 items-center"
    hx-ext="client-side-templates"
    nunjucks-template="{{ _make_script_id({ 'id': props.id, 'state': not props.state }) }}"
    hx-target="this"
  >
  
    <div class="relative">
      <div 
        hx-trigger="click"
        hx-get="../_.json"
        hx-swap="outerHTML"
        class="
          w-{{10 * size}} 
          h-{{6 * size}} 
          bg-{{ 'blue-600' if props.state else 'gray-200' }} 
          rounded-full 
          cursor-pointer
          after:content-[''] 
          after:absolute 
          after:top-[{{2 * size}}px] 
          after:bg-white 
          after:border-{{ 'white' if props.state else 'gray-300' }} 
          after:border 
          after:rounded-full 
          after:h-{{5 * size}} 
          after:w-{{5 * size}} 
          after:transition-all 
          {{ 'after:translate-x-full' if props.state }} 
        "
      >
      </div>
    </div>

    <div class="text-xl flex flex-row gap-4">
      <div>state: {{ "on" if props.state else "off" }},</div>
      <div>id: {{ props.id }}</div>
    </div>
    
  </div>
{% endmacro %}

{% macro _make_script_id(props) -%}
  {{ props | dump | urlencode | replace('%', '_') }}
{%- endmacro %}
